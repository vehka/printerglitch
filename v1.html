<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analog Glitch Art Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      color: #ffffff;
      display: flex;
      gap: 20px;
    }
    
    #canvas-container {
      flex: 1;
      background: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    }
    
    #controls {
      width: 320px;
      background: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      height: fit-content;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .control-group {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #444;
    }
    
    .control-group:last-child {
      border-bottom: none;
    }
    
    h2 {
      margin: 0 0 15px 0;
      font-size: 14px;
      text-transform: uppercase;
      color: #888;
      letter-spacing: 1px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-size: 12px;
      color: #aaa;
    }
    
    input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }
    
    input[type="checkbox"] {
      margin-right: 8px;
    }
    
    button {
      width: 100%;
      padding: 12px;
      margin: 5px 0;
      background: #4a9eff;
      border: none;
      color: white;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #357abd;
    }
    
    button.secondary {
      background: #555;
    }
    
    button.secondary:hover {
      background: #666;
    }
    
    .value-display {
      float: right;
      color: #4a9eff;
      font-weight: bold;
    }
    
    textarea {
      width: 100%;
      height: 100px;
      background: #1a1a1a;
      border: 1px solid #444;
      color: #fff;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      padding: 8px;
      box-sizing: border-box;
      resize: vertical;
    }
    
    .checkbox-group {
      margin: 8px 0;
    }
    
    select {
      width: 100%;
      padding: 8px;
      background: #1a1a1a;
      border: 1px solid #444;
      color: #fff;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-bottom: 10px;
    }
    
    #preset-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      margin-top: 10px;
    }
    
    #preset-buttons button {
      padding: 8px;
      font-size: 11px;
    }
  </style>
</head>
<body>
  <div id="canvas-container"></div>
  <div id="controls">
    <h1 style="margin-top: 0; font-size: 18px;">Analog Glitch Art</h1>
    
    <div class="control-group">
      <h2>Presets</h2>
      <div id="preset-buttons">
        <button class="secondary" onclick="loadPreset('scan')">Scan Damage</button>
        <button class="secondary" onclick="loadPreset('fax')">Fax Error</button>
        <button class="secondary" onclick="loadPreset('thermal')">Thermal Print</button>
        <button class="secondary" onclick="loadPreset('ocr')">OCR Fail</button>
        <button class="secondary" onclick="loadPreset('heavy')">Heavy Glitch</button>
        <button class="secondary" onclick="loadPreset('subtle')">Subtle Noise</button>
      </div>
    </div>
    
    <div class="control-group">
      <h2>Character Settings</h2>
      <label>
        Density <span class="value-display" id="density-val">30%</span>
        <input type="range" id="density" min="5" max="100" value="30" oninput="updateConfig()">
      </label>
      <label>
        Corruption Level <span class="value-display" id="corruption-val">70%</span>
        <input type="range" id="corruption" min="0" max="100" value="70" oninput="updateConfig()">
      </label>
      <label>
        Font Size <span class="value-display" id="fontsize-val">12</span>
        <input type="range" id="fontsize" min="6" max="24" value="12" oninput="updateConfig()">
      </label>
      <label>
        Size Variation <span class="value-display" id="sizevar-val">50%</span>
        <input type="range" id="sizevar" min="0" max="100" value="50" oninput="updateConfig()">
      </label>
    </div>
    
    <div class="control-group">
      <h2>Spatial Effects</h2>
      <label>
        Rotation Range <span class="value-display" id="rotation-val">45¬∞</span>
        <input type="range" id="rotation" min="0" max="180" value="45" oninput="updateConfig()">
      </label>
      <label>
        Position Drift <span class="value-display" id="drift-val">50%</span>
        <input type="range" id="drift" min="0" max="100" value="50" oninput="updateConfig()">
      </label>
      <label>
        Cluster Strength <span class="value-display" id="cluster-val">40%</span>
        <input type="range" id="cluster" min="0" max="100" value="40" oninput="updateConfig()">
      </label>
    </div>
    
    <div class="control-group">
      <h2>Character Sets</h2>
      <div class="checkbox-group">
        <label><input type="checkbox" id="set-latin" checked onchange="updateConfig()"> Latin Letters</label>
        <label><input type="checkbox" id="set-numbers" checked onchange="updateConfig()"> Numbers</label>
        <label><input type="checkbox" id="set-symbols" checked onchange="updateConfig()"> Symbols</label>
        <label><input type="checkbox" id="set-cyrillic" onchange="updateConfig()"> Cyrillic</label>
        <label><input type="checkbox" id="set-special" onchange="updateConfig()"> Special Unicode</label>
        <label><input type="checkbox" id="set-corruption" checked onchange="updateConfig()"> Box Characters</label>
      </div>
    </div>
    
    <div class="control-group">
      <h2>Glitch Effects</h2>
      <div class="checkbox-group">
        <label><input type="checkbox" id="effect-scanlines" checked onchange="updateConfig()"> Scan Lines</label>
        <label><input type="checkbox" id="effect-ghosting" checked onchange="updateConfig()"> Character Ghosting</label>
        <label><input type="checkbox" id="effect-blocks" checked onchange="updateConfig()"> Compression Blocks</label>
        <label><input type="checkbox" id="effect-barcode" onchange="updateConfig()"> Barcode Pattern</label>
        <label><input type="checkbox" id="effect-noise" checked onchange="updateConfig()"> Background Noise</label>
      </div>
    </div>
    
    <div class="control-group">
      <h2>Source Document (Optional)</h2>
      <div class="checkbox-group">
        <label><input type="checkbox" id="use-source" onchange="updateConfig()"> Use Source Text</label>
      </div>
      <textarea id="source-text" placeholder="Paste text here to glitch an actual document..."></textarea>
    </div>
    
    <div class="control-group">
      <button onclick="regenerate()">‚ü≥ Regenerate</button>
      <button onclick="saveImage()" class="secondary">üíæ Save Image</button>
      <button onclick="randomize()" class="secondary">üé≤ Randomize All</button>
    </div>
  </div>
  <script>

    // Configuration object
let config = {
  density: 0.3,
  corruptionLevel: 0.7,
  repetitionProb: 0.3,  // Probability of repeating characters
  repetitionLength: 3,   // How many times to repeat (max)  sizeVariation: 0.5,
  clusterStrength: 0.4,
  positionDrift: 0.5,
  baseFontSize: 12,
  useSourceDoc: false,
  sourceText: '',
  charSets: {
    latin: true,
    numbers: true,
    symbols: true,
    cyrillic: false,
    special: false,
    corruption: true
  },
  effects: {
    scanlines: true,
    ghosting: true,
    blocks: true,
    barcode: false,
    noise: true
  }
};

// UI elements
let sliders = {};
let checkboxes = {};
let buttons = {};
let sourceTextarea;

// Character set definitions
const charSets = {
  latin: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz',
  numbers: '0123456789',
  symbols: '!@#$%^&*(){}[]|\\/<>~`-_=+;:\'",.',
  cyrillic: '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è',
  special: '‚Üí‚Üê‚Üë‚Üì‚àû‚âà‚â†¬±√ó√∑¬ß¬∂‚Ä†‚Ä°¬©¬Æ‚Ñ¢‚Ç¨¬£¬•¬¢¬∞‚Ä¢¬∑‚Ä¶""\'\'‚Äî‚Äì',
  corruption: '‚ñì‚ñí‚ñë‚ñà‚ñÑ‚ñÄ‚ñ†‚ñ°‚óè‚óã‚óÜ‚óá‚ñ™‚ñ´'
};

function randomChar(str) {
  return str.charAt(floor(random(str.length)));
}

let glitchPositions = [];
let canvasWidth = 800;
let canvasHeight = 1000;

function setup() {
  createCanvas(canvasWidth, canvasHeight);
  textFont('Courier New');
  
  // Create UI
  createUI();
  regenerate();
}

function draw() {
  // Static image - only redraw when regenerate is called
}

function createUI() {
  let yPos = 20;
  let xPos = canvasWidth + 20;
  
  // Title
  let title = createP('Analog Glitch Art Generator');
  title.position(xPos, yPos);
  title.style('font-family', 'Courier New');
  title.style('font-weight', 'bold');
  yPos += 40;
  
  // Presets
  createP('Presets:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 25;
  
  let presets = ['Scan', 'Fax', 'Thermal', 'OCR', 'Heavy', 'Subtle'];
  for (let i = 0; i < presets.length; i++) {
    let btn = createButton(presets[i]);
    btn.position(xPos + (i % 3) * 80, yPos + floor(i / 3) * 30);
    btn.mousePressed(() => loadPreset(presets[i].toLowerCase()));
    btn.style('font-family', 'Courier New');
    btn.style('font-size', '10px');
  }
  yPos += 80;
  
  // Sliders
  createP('Density:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.density = createSlider(5, 100, 30, 1);
  sliders.density.position(xPos, yPos);
  sliders.density.input(updateConfig);
  yPos += 40;
  
  createP('Corruption:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.corruption = createSlider(0, 100, 70, 1);
  sliders.corruption.position(xPos, yPos);
  sliders.corruption.input(updateConfig);
  yPos += 40;
  
  createP('Font Size:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.fontsize = createSlider(6, 24, 12, 1);
  sliders.fontsize.position(xPos, yPos);
  sliders.fontsize.input(updateConfig);
  yPos += 40;
  
  createP('Size Variation:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.sizevar = createSlider(0, 100, 50, 1);
  sliders.sizevar.position(xPos, yPos);
  sliders.sizevar.input(updateConfig);
  yPos += 40;
  
  createP('Repetition:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.repetition = createSlider(0, 100, 30, 1);
  sliders.repetition.position(xPos, yPos);
  sliders.repetition.input(updateConfig);
  yPos += 40;

  createP('Repeat Length:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.repLength = createSlider(2, 8, 3, 1);
  sliders.repLength.position(xPos, yPos);
  sliders.repLength.input(updateConfig);
  yPos += 40;
  
  createP('Position Drift:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.drift = createSlider(0, 100, 50, 1);
  sliders.drift.position(xPos, yPos);
  sliders.drift.input(updateConfig);
  yPos += 40;
  
  createP('Clustering:').position(xPos, yPos).style('font-family', 'Courier New');
  yPos += 20;
  sliders.cluster = createSlider(0, 100, 40, 1);
  sliders.cluster.position(xPos, yPos);
  sliders.cluster.input(updateConfig);
  yPos += 50;
  
  // Character sets
  createP('Character Sets:').position(xPos, yPos).style('font-family', 'Courier New').style('font-weight', 'bold');
  yPos += 25;
  
  checkboxes.latin = createCheckbox('Latin', true);
  checkboxes.latin.position(xPos, yPos);
  checkboxes.latin.changed(updateConfig);
  yPos += 25;
  
  checkboxes.numbers = createCheckbox('Numbers', true);
  checkboxes.numbers.position(xPos, yPos);
  checkboxes.numbers.changed(updateConfig);
  yPos += 25;
  
  checkboxes.symbols = createCheckbox('Symbols', true);
  checkboxes.symbols.position(xPos, yPos);
  checkboxes.symbols.changed(updateConfig);
  yPos += 25;
  
  checkboxes.cyrillic = createCheckbox('Cyrillic', false);
  checkboxes.cyrillic.position(xPos, yPos);
  checkboxes.cyrillic.changed(updateConfig);
  yPos += 25;
  
  checkboxes.special = createCheckbox('Special', false);
  checkboxes.special.position(xPos, yPos);
  checkboxes.special.changed(updateConfig);
  yPos += 25;
  
  checkboxes.corruption = createCheckbox('Box Chars', true);
  checkboxes.corruption.position(xPos, yPos);
  checkboxes.corruption.changed(updateConfig);
  yPos += 40;
  
  // Effects
  createP('Effects:').position(xPos, yPos).style('font-family', 'Courier New').style('font-weight', 'bold');
  yPos += 25;
  
  checkboxes.scanlines = createCheckbox('Scan Lines', true);
  checkboxes.scanlines.position(xPos, yPos);
  checkboxes.scanlines.changed(updateConfig);
  yPos += 25;
  
  checkboxes.ghosting = createCheckbox('Ghosting', true);
  checkboxes.ghosting.position(xPos, yPos);
  checkboxes.ghosting.changed(updateConfig);
  yPos += 25;
  
  checkboxes.blocks = createCheckbox('Compression', true);
  checkboxes.blocks.position(xPos, yPos);
  checkboxes.blocks.changed(updateConfig);
  yPos += 25;
  
  checkboxes.barcode = createCheckbox('Barcode', false);
  checkboxes.barcode.position(xPos, yPos);
  checkboxes.barcode.changed(updateConfig);
  yPos += 25;
  
  checkboxes.noise = createCheckbox('Noise', true);
  checkboxes.noise.position(xPos, yPos);
  checkboxes.noise.changed(updateConfig);
  yPos += 40;
  
  // Source document
  createP('Source Text (optional):').position(xPos, yPos).style('font-family', 'Courier New').style('font-weight', 'bold');
  yPos += 25;
  
  checkboxes.useSource = createCheckbox('Use Source', false);
  checkboxes.useSource.position(xPos, yPos);
  checkboxes.useSource.changed(updateConfig);
  yPos += 25;
  
  sourceTextarea = createElement('textarea');
  sourceTextarea.position(xPos, yPos);
  sourceTextarea.size(240, 100);
  sourceTextarea.attribute('placeholder', 'Paste text to glitch...');
  sourceTextarea.style('font-family', 'Courier New');
  sourceTextarea.style('font-size', '10px');
  yPos += 120;
  
  // Action buttons
  let regenBtn = createButton('Regenerate');
  regenBtn.position(xPos, yPos);
  regenBtn.mousePressed(regenerate);
  regenBtn.style('font-family', 'Courier New');
  yPos += 35;
  
  let saveBtn = createButton('Save Image');
  saveBtn.position(xPos, yPos);
  saveBtn.mousePressed(() => saveCanvas('glitch-art-' + Date.now(), 'png'));
  saveBtn.style('font-family', 'Courier New');
  yPos += 35;
  
  let randomBtn = createButton('Randomize');
  randomBtn.position(xPos, yPos);
  randomBtn.mousePressed(randomize);
  randomBtn.style('font-family', 'Courier New');
}

function regenerate() {
  background(255);
  
  // Add background noise if enabled
  if (config.effects.noise) {
    drawBackgroundNoise();
  }
  
  // Generate positions
  glitchPositions = config.useSourceDoc ? 
    generateFromSource() : 
    generateRandomPositions();
  
  // Draw ghosting layer first (behind main characters)
  if (config.effects.ghosting) {
    drawGhosting();
  }
  
  // Draw main characters
  drawCharacters();
  
  // Apply effects on top
  if (config.effects.scanlines) {
    drawScanlines();
  }
  
  if (config.effects.blocks) {
    drawCompressionBlocks();
  }
  
  if (config.effects.barcode) {
    drawBarcodePattern();
  }
}

function generateRandomPositions() {
  let positions = [];
  let charPool = getActiveCharPool();
  
  if (charPool.length === 0) {
    charPool = ['X']; // Fallback if no sets selected
  }
  
  // Use noise-based density for clustering
  noiseSeed(random(10000));
  
  let gridSpacing = config.baseFontSize * 1.2;
  
  for (let y = 0; y < height; y += gridSpacing) {
    for (let x = 0; x < width; x += gridSpacing) {
      
      // Noise-based density variation
      let noiseVal = noise(x * 0.005, y * 0.005);
      let densityThreshold = 1 - config.density;
      
      // Apply cluster strength
      let clusterMod = map(config.clusterStrength, 0, 1, 0.5, 1.5);
      noiseVal = pow(noiseVal, clusterMod);
      
      if (noiseVal > densityThreshold) {
        let driftX = randomGaussian(0, config.positionDrift * 15);
        let driftY = randomGaussian(0, config.positionDrift * 8);
        
        let char = randomChar(charPool.join(''));
        
        positions.push({
          x: x + driftX,
          y: y + driftY,
          char: char,
          size: config.baseFontSize * random(1 - config.sizeVariation, 1 + config.sizeVariation),
          opacity: random(180, 255)
        });
        
        // Maybe repeat this character
        if (random() < config.repetitionProb) {
          let repeatCount = floor(random(2, config.repetitionLength + 1));
          let repeatDir = floor(random(4)); // 0=right, 1=down, 2=diagonal-right, 3=diagonal-left
          
          for (let r = 1; r <= repeatCount; r++) {
            let offsetX = 0, offsetY = 0;
            
            switch(repeatDir) {
              case 0: // horizontal right
                offsetX = r * gridSpacing * 0.8;
                break;
              case 1: // vertical down
                offsetY = r * gridSpacing * 0.8;
                break;
              case 2: // diagonal down-right
                offsetX = r * gridSpacing * 0.6;
                offsetY = r * gridSpacing * 0.6;
                break;
              case 3: // diagonal down-left
                offsetX = -r * gridSpacing * 0.6;
                offsetY = r * gridSpacing * 0.6;
                break;
            }
            
            positions.push({
              x: x + driftX + offsetX,
              y: y + driftY + offsetY,
              char: char, // Same character
              size: config.baseFontSize * random(1 - config.sizeVariation * 0.5, 1 + config.sizeVariation * 0.5),
              opacity: random(150, 255)
            });
          }
        }
      }
    }
  }
  
  return positions;
}

function generateFromSource() {
  let positions = [];
  let charPool = getActiveCharPool();
  let text = config.sourceText || "NO SOURCE TEXT PROVIDED";
  let chars = text.split('');
  
  let x = 50;
  let y = 50;
  let lineHeight = config.baseFontSize * 1.8;
  let charWidth = config.baseFontSize * 0.7;
  
  for (let i = 0; i < chars.length; i++) {
    let char = chars[i];
    
    // Handle newlines
    if (char === '\n') {
      x = 50;
      y += lineHeight;
      continue;
    }
    
    // Maybe corrupt the character
    if (random() < config.corruptionLevel) {
      char = random(charPool);
    }
    
    let driftX = randomGaussian(0, config.corruptionLevel * 20);
    let driftY = randomGaussian(0, config.corruptionLevel * 10);
    
    positions.push({
      x: x + driftX,
      y: y + driftY,
      char: char,
      rotation: random(-config.corruptionLevel * config.rotationRange, 
                      config.corruptionLevel * config.rotationRange),
      size: config.baseFontSize * random(1 - config.sizeVariation * 0.5, 
                                          1 + config.sizeVariation * 0.5),
      opacity: random(150, 255)
    });
    
    x += charWidth;
    
    // Wrap at edge
    if (x > width - 100) {
      x = 50;
      y += lineHeight;
    }
    
    // Stop if we go off bottom
    if (y > height - 50) {
      break;
    }
  }
  
  return positions;
}

function drawCharacters() {
  fill(0);
  noStroke();
  
  for (let p of glitchPositions) {
    push();
    translate(p.x, p.y);
    textSize(p.size);
    fill(0, p.opacity);
    textAlign(CENTER, CENTER);
    text(p.char, 0, 0);
    pop();
  }
}

function drawGhosting() {
  fill(0, 50);
  noStroke();
  
  for (let p of glitchPositions) {
    if (random() < 0.15) {
      let ghostCount = floor(random(1, 4));
      for (let i = 0; i < ghostCount; i++) {
        push();
        translate(p.x + random(-5, 5), p.y + random(-5, 5));
        textSize(p.size);
        textAlign(CENTER, CENTER);
        text(p.char, 0, 0);
        pop();
      }
    }
  }
}

function drawScanlines() {
  stroke(0, random(20, 40));
  strokeWeight(random(0.5, 1.5));
  
  for (let y = 0; y < height; y += random(3, 12)) {
    let x1 = random(-20, 0);
    let x2 = width + random(0, 20);
    line(x1, y, x2, y);
  }
}

function drawCompressionBlocks() {
  noStroke();
  
  for (let i = 0; i < 30; i++) {
    fill(0, random(10, 50));
    let w = random(10, 80);
    let h = random(5, 30);
    rect(random(width - w), random(height - h), w, h);
  }
  
  // Some white blocks too
  for (let i = 0; i < 15; i++) {
    fill(255, random(100, 200));
    let w = random(5, 40);
    let h = random(3, 15);
    rect(random(width - w), random(height - h), w, h);
  }
}

function drawBarcodePattern() {
  stroke(0);
  strokeWeight(1);
  
  // Bottom barcode-like pattern
  let startY = height - 100;
  let barCount = floor(random(50, 150));
  
  for (let i = 0; i < barCount; i++) {
    let x = random(width);
    let barHeight = random(20, 80);
    let barWidth = random(1, 4);
    
    strokeWeight(barWidth);
    line(x, startY, x, startY + barHeight);
  }
}

function drawBackgroundNoise() {
  loadPixels();
  for (let i = 0; i < pixels.length; i += 4) {
    if (random() < 0.02) {
      let noise = random(200, 255);
      pixels[i] = noise;
      pixels[i + 1] = noise;
      pixels[i + 2] = noise;
    }
  }
  updatePixels();
}

function getActiveCharPool() {
  let pool = '';
  
  if (config.charSets.latin) pool += charSets.latin;
  if (config.charSets.numbers) pool += charSets.numbers;
  if (config.charSets.symbols) pool += charSets.symbols;
  if (config.charSets.cyrillic) pool += charSets.cyrillic;
  if (config.charSets.special) pool += charSets.special;
  if (config.charSets.corruption) pool += charSets.corruption;
  
  return pool.split(''); // Convert string to array
}

function updateConfig() {
  // Update numeric values from sliders
  config.density = sliders.density.value() / 100;
  config.corruptionLevel = sliders.corruption.value() / 100;
  config.repetitionProb = sliders.repetition.value() / 100;
  config.repetitionLength = sliders.repLength.value();
  config.sizeVariation = sliders.sizevar.value() / 100;
  config.clusterStrength = sliders.cluster.value() / 100;
  config.positionDrift = sliders.drift.value() / 100;
  config.baseFontSize = sliders.fontsize.value();
  
  // Update character sets from checkboxes
  config.charSets.latin = checkboxes.latin.checked();
  config.charSets.numbers = checkboxes.numbers.checked();
  config.charSets.symbols = checkboxes.symbols.checked();
  config.charSets.cyrillic = checkboxes.cyrillic.checked();
  config.charSets.special = checkboxes.special.checked();
  config.charSets.corruption = checkboxes.corruption.checked();
  
  // Update effects
  config.effects.scanlines = checkboxes.scanlines.checked();
  config.effects.ghosting = checkboxes.ghosting.checked();
  config.effects.blocks = checkboxes.blocks.checked();
  config.effects.barcode = checkboxes.barcode.checked();
  config.effects.noise = checkboxes.noise.checked();
  
  // Update source document settings
  config.useSourceDoc = checkboxes.useSource.checked();
  config.sourceText = sourceTextarea.elt.value;

  
  // Auto-regenerate on change
  regenerate();
}

function randomize() {
  sliders.density.value(random(10, 80));
  sliders.corruption.value(random(30, 100));
  sliders.repetition.value(random(10, 80));
  sliders.repLength.value(random(2, 6));
  sliders.sizevar.value(random(0, 100));
  sliders.cluster.value(random(0, 80));
  sliders.drift.value(random(0, 100));
  sliders.fontsize.value(random(8, 18));
  
  updateConfig();
}

function loadPreset(presetName) {
  const presets = {
    scan: {
      density: 35, corruption: 60, repetition: 20, repLength: 3, sizevar: 30, 
      cluster: 20, drift: 40, fontsize: 11,
      scanlines: true, ghosting: false, blocks: true, barcode: false, noise: true
    },
    fax: {
      density: 50, corruption: 80, repetition: 20, repLength: 3, sizevar: 20, 
      cluster: 60, drift: 70, fontsize: 10,
      scanlines: true, ghosting: true, blocks: false, barcode: true, noise: true
    },
    thermal: {
      density: 40, corruption: 50, repetition: 20, repLength: 3, sizevar: 40, 
      cluster: 30, drift: 20, fontsize: 9,
      scanlines: false, ghosting: true, blocks: true, barcode: false, noise: false
    },
    ocr: {
      density: 60, corruption: 90, repetition: 20, repLength: 3, sizevar: 60, 
      cluster: 10, drift: 80, fontsize: 12,
      scanlines: false, ghosting: false, blocks: false, barcode: false, noise: true
    },
    heavy: {
      density: 70, corruption: 95, repetition: 20, repLength: 3, sizevar: 80, 
      cluster: 70, drift: 90, fontsize: 14,
      scanlines: true, ghosting: true, blocks: true, barcode: true, noise: true
    },
    subtle: {
      density: 20, corruption: 30, repetition: 20, repLength: 3, sizevar: 20, 
      cluster: 40, drift: 25, fontsize: 10,
      scanlines: false, ghosting: false, blocks: false, barcode: false, noise: true
    }
  };
  
  const preset = presets[presetName];
  if (!preset) return;
  
  sliders.density.value(preset.density);
  sliders.corruption.value(preset.corruption);
  sliders.repetition.value(preset.repetition);
  sliders.repLength.value(preset.repLength);
  sliders.sizevar.value(preset.sizevar);
  sliders.cluster.value(preset.cluster);
  sliders.drift.value(preset.drift);
  sliders.fontsize.value(preset.fontsize);
  
  checkboxes.scanlines.checked(preset.scanlines);
  checkboxes.ghosting.checked(preset.ghosting);
  checkboxes.blocks.checked(preset.blocks);
  checkboxes.barcode.checked(preset.barcode);
  checkboxes.noise.checked(preset.noise);
  
  updateConfig();
}

</script>
</body>
</html>